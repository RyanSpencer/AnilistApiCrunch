<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title></title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
        <script src="/client/client.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="main.css">
    </head>
    <body>
        <div id="mainApp">
            <form id="searchForm" action="/userSearch" method="get">
                <input id="usernameSearch" type="text" name="term" placeholder="Your AniList Username">
                <input id="submitButton" type="submit" value="Search for Recs" :disabled="loading">
                <label for="includeWatching" class="form-check-label">Include Currently Watching: </label>
                <input id="includeWatching" class="form-check-input" type="checkbox" name="watching" checked>
                <label for="includeDropped" class="form-check-label">Include Dropped: </label>
                <input id="includeDropped" class="form-check-input" type="checkbox" name="dropped" checked>
                <label for="includePaused" class="form-check-label">Include Paused: </label>
                <input id="includePaused" class="form-check-input" type="checkbox" name="paused" checked>
            </form>
            <div v-if="fullRec.length === 0 && !loading">
                <p>This is an app to get data from the anilist API. This search will return the top recommended anime based on your list. Enter you Anilist id in the text search. 
                    By default completed and rewatching are included, and only entries that score more than a zero are calculated. 
                    Each checkbox will allow you to include another list, which will add score entries to the calculation and not recomend any entries in the list to you</p>
            </div>
            <div id="apiCall"  v-if="loading" class="spinner-border d-flex justify-content-center" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            <div id = "dataArea" v-show="!loading && fullRec.length > 0">
                <div id="view-preferences">
                    <label class="form-check-label" for="romajiName">Use Romaji: </label>
                    <input class="form-check-input" v-model="titleLanguage" value="romaji" type="radio" id="romanjiName" name="nameRadio">
                    
                    <label class="form-check-label" for="englishName">Use English: </label>
                    <input class= "form-check-input" v-model="titleLanguage" value="english" type="radio" id="englishName" name="nameRadio" checked>
                    <div id="format-preferences">
                        <label v-for="format in formats" class="form-check-label" :for="format.name">{{format.name}}
                            <input class="form-check-input" v-model="format.active" type="checkbox" :name="format.name" :value="format.value" checked>
                        </label>
                    </div>
                    <div id="year-range">
                        <label class="form-check-label" for="afterYear">After: {{startYear}}
                            <input class="form-input" type="range" id="afterYear" v-model="startYear" name="afterYear" min="1940" :max="endYear">
                        </label>
                        <label  class="form-check-label" for="beforeYear">Before: {{endYear}}
                            <input class="form-input" type="range" id="beforeYear" v-model="endYear" name="beforeYear" :min="startYear" max="2025">
                        </label>
                    </div>
                    <nav>
                        <ul class="pagination">
                          <li class="page-item" v-for="page in 8" v-bind:class="{active: currentPage == page}" :id="page + '-page-link'"><a class="page-link" href=""  v-bind:data-page="page">{{page}}</a></li>
                        </ul>
                      </nav>
                </div>
                <div id="result" class="row row-cols-5 gy-3">
                    <anime-rec
                        v-for= "rec in recs"
                        v-show= "rec.show"
                        v-bind:rec="rec"
                        v-bind:key="rec.id"
                        v-bind:title-language="titleLanguage"
                    >
                    </anime-rec>
                </div>
            </div>
            <div class="modal fade" id="recDataModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>                    
                        <div class="modal-body">
                            <div v-for="source in sources">
                                <p>{{((titleLanguage === 'english' && source.englishName != null) || source.romajiName == null)? source.englishName : source.romajiName}} had {{source.upvotes}} out of {{source.totalUpvotes}} with a score of {{source.score}}</p> </br> 
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>